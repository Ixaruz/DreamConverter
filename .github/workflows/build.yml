# build.yml
name: Build
on:
  push:
    branches: [ master ]

  workflow_dispatch:
    inputs:
      BUILD_VERSION:
        description: 'Version of the build'
        required: false
        default: '0.0.0'

jobs:
  build:
    runs-on: ubuntu-latest
    container:
       image: danger89/cmake
    steps:
      - name: checkout repo
        uses: actions/checkout@v4
        with:
            submodules: recursive
      - name: build application
        run: |
          cmake -B build -G Ninja -DCMAKE_BUILD_TYPE=Release -D BUILD_VERSION=${{ github.event.inputs.BUILD_VERSION }}
          ninja -C build package -j $(($(nproc) + 1))
      - name: Upload artifacts
        uses: actions/upload-artifact@v4
        with:
          name: DreamConverter
          path: |
            build/DreamConverter-*.tar.gz

